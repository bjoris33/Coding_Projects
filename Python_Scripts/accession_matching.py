import xml.etree.ElementTree as ET
import urllib.request, urllib.parse, urllib.error
import ssl
import json

acclist=['SRR341581',   'SRR341582',   'SRR341583',   'SRR341584',   'SRR341585',   'SRR341586',   'SRR341587',   'SRR341588',   'SRR341654',   'SRR341589',   'SRR341655',   'SRR341656',   'SRR341657',   'SRR341658',   'SRR341590',   'SRR341591',   'SRR341592',   'SRR341593',   'SRR341594',   'SRR341595',   'SRR341596',   'SRR341597',   'SRR341659',   'SRR341598',   'SRR341660',   'SRR341661',   'SRR341662',   'SRR341663',   'SRR341664',   'SRR341665',   'SRR341666',   'SRR341667',   'SRR341668',   'SRR341669',   'SRR341670',   'SRR341671',   'SRR341672',   'SRR341673',   'SRR341674',   'SRR341599',   'SRR341675',   'SRR341676',   'SRR341677',   'SRR341600',   'SRR341678',   'SRR341601',   'SRR341602',   'SRR341603',   'SRR341604',   'SRR341605',   'SRR341606',   'SRR341679',   'SRR341680',   'SRR341607',   'SRR341681',   'SRR341682',   'SRR341608',   'SRR341683',   'SRR341609',   'SRR341684',   'SRR341685',   'SRR341610',   'SRR341686',   'SRR341687',   'SRR341611',   'SRR341612',   'SRR341688',   'SRR341613',   'SRR341614',   'SRR341615',   'SRR341689',   'SRR341616',   'SRR341617',   'SRR341618',   'SRR341619',   'SRR341620',   'SRR341690',   'SRR341621',   'SRR341622',   'SRR341623',   'SRR341691',   'SRR341692',   'SRR341624',   'SRR341693',   'SRR341625',   'SRR341694',   'SRR341626',   'SRR341695',   'SRR341627',   'SRR341696',   'SRR341697',   'SRR341628',   'SRR341629',   'SRR341698',   'SRR341630',   'SRR341631',   'SRR341632',   'SRR341699',   'SRR341700',   'SRR341633',   'SRR341701',   'SRR341634',   'SRR341702',   'SRR341703',   'SRR341704',   'SRR341705',   'SRR341706',   'SRR341707',   'SRR341635',   'SRR341636',   'SRR341637',   'SRR341708',   'SRR341638',   'SRR341639',   'SRR341709',   'SRR341640',   'SRR341710',   'SRR341641',   'SRR341711',   'SRR341642',   'SRR341643',   'SRR341712',   'SRR341713',   'SRR341644',   'SRR341714',   'SRR341645',   'SRR341646',   'SRR341715',   'SRR341716',   'SRR341647',   'SRR341648',   'SRR341717',   'SRR341718',   'SRR341719',   'SRR341720',   'SRR341649',   'SRR341721',   'SRR341722',   'SRR341650',   'SRR341651',   'SRR341723',   'SRR341652',   'SRR341724',   'SRR341725',   'SRR341653',   'SRR413615',   'SRR413626',   'SRR413631',   'SRR413632',   'SRR413633',   'SRR413634',   'SRR413668',   'SRR413669',   'SRR413670',   'SRR413671',   'SRR413672',   'SRR1778454',   'SRR1778455',   'SRR1778456',   'SRR1778451',   'SRR1778452',   'SRR1778453',   'SRR413724',   'SRR413725',   'SRR413726',   'SRR413727',   'SRR413730',   'SRR413731']
acclist2=['ERZ791569', 'ERZ791570', 'ERZ791571', 'ERZ791572', 'ERZ791573', 'ERZ791574', 'ERZ791575', 'ERZ791576', 'ERZ791577', 'ERZ791578', 'ERZ791579', 'ERZ791580', 'ERZ791581', 'ERZ791582', 'ERZ791583', 'ERZ791584', 'ERZ791585', 'ERZ791586', 'ERZ791587', 'ERZ791588', 'ERZ791589', 'ERZ791590', 'ERZ791591', 'ERZ791592', 'ERZ791593', 'ERZ791594', 'ERZ791595', 'ERZ791596', 'ERZ791597', 'ERZ791598', 'ERZ791599', 'ERZ791600', 'ERZ791601', 'ERZ791602', 'ERZ791603', 'ERZ791604', 'ERZ791605', 'ERZ791606', 'ERZ791607', 'ERZ791608', 'ERZ791609', 'ERZ791610', 'ERZ791611', 'ERZ791612', 'ERZ791613', 'ERZ791614', 'ERZ791615', 'ERZ791616', 'ERZ791617', 'ERZ791618', 'ERZ791619', 'ERZ791620', 'ERZ791621', 'ERZ791622', 'ERZ791623', 'ERZ791624', 'ERZ791625', 'ERZ791626', 'ERZ791627', 'ERZ791628', 'ERZ791629', 'ERZ791630', 'ERZ791631', 'ERZ791632', 'ERZ791633', 'ERZ791634', 'ERZ791635', 'ERZ791636', 'ERZ791637', 'ERZ791638', 'ERZ791639', 'ERZ791640', 'ERZ791641', 'ERZ791642', 'ERZ791643', 'ERZ791644', 'ERZ791645', 'ERZ791646', 'ERZ791647', 'ERZ791648', 'ERZ791649', 'ERZ791650', 'ERZ791651', 'ERZ791652', 'ERZ791653', 'ERZ791654', 'ERZ791655', 'ERZ791656', 'ERZ791657', 'ERZ791658', 'ERZ791659', 'ERZ791660', 'ERZ791661', 'ERZ791662', 'ERZ791663', 'ERZ791664', 'ERZ791665', 'ERZ791666', 'ERZ791667', 'ERZ791668', 'ERZ791669', 'ERZ791670', 'ERZ791671', 'ERZ791672', 'ERZ791673', 'ERZ791674', 'ERZ791675', 'ERZ791676', 'ERZ791677', 'ERZ791678', 'ERZ791679', 'ERZ791680', 'ERZ791681', 'ERZ791682', 'ERZ791683', 'ERZ791684', 'ERZ791685', 'ERZ791686', 'ERZ791687', 'ERZ791688', 'ERZ791689', 'ERZ791690', 'ERZ791691', 'ERZ791692', 'ERZ791693', 'ERZ791694', 'ERZ791695', 'ERZ791696', 'ERZ791697', 'ERZ791698', 'ERZ791699', 'ERZ791700', 'ERZ791701', 'ERZ791702', 'ERZ791703', 'ERZ791704', 'ERZ791705', 'ERZ791706', 'ERZ791707', 'ERZ791708', 'ERZ791709', 'ERZ791710', 'ERZ791711', 'ERZ791712', 'ERZ791713', 'ERZ791714', 'ERZ791715', 'ERZ791716', 'ERZ791717', 'ERZ791718', 'ERZ791719', 'ERZ791720', 'ERZ791721', 'ERZ791722', 'ERZ791723', 'ERZ791724', 'ERZ791725', 'ERZ791726', 'ERZ791727', 'ERZ791728', 'ERZ791729', 'ERZ791730', 'ERZ791731', 'ERZ791732', 'ERZ791733', 'ERZ791734', 'ERZ791735', 'ERZ791736', 'ERZ791737', 'ERZ791738', 'ERZ791739', 'ERZ791740', 'ERZ791741', 'ERZ791742', 'ERZ791743', 'ERZ791744', 'ERZ791745', 'ERZ791746', 'ERZ791747', 'ERZ791748', 'ERZ791749', 'ERZ791750', 'ERZ791751', 'ERZ791752', 'ERZ791753', 'ERZ791754', 'ERZ791755', 'ERZ791756', 'ERZ791757', 'ERZ791758', 'ERZ791759', 'ERZ791760', 'ERZ791761', 'ERZ791762', 'ERZ791763', 'ERZ791764', 'ERZ791765', 'ERZ791766', 'ERZ791767', 'ERZ791768', 'ERZ791769', 'ERZ791770', 'ERZ791771', 'ERZ791772', 'ERZ791773', 'ERZ791774', 'ERZ791775', 'ERZ791776', 'ERZ791777', 'ERZ791778', 'ERZ791779', 'ERZ791780', 'ERZ791781', 'ERZ791782', 'ERZ791783', 'ERZ791784', 'ERZ791785', 'ERZ791786', 'ERZ791787', 'ERZ791788', 'ERZ791789', 'ERZ791790', 'ERZ791791', 'ERZ791792', 'ERZ791793', 'ERZ791794', 'ERZ791795', 'ERZ791796', 'ERZ791797', 'ERZ791798', 'ERZ791799', 'ERZ791800', 'ERZ791801', 'ERZ791802', 'ERZ791803', 'ERZ791804', 'ERZ791805', 'ERZ791806', 'ERZ791807', 'ERZ791808', 'ERZ791809', 'ERZ791810', 'ERZ791811', 'ERZ791812', 'ERZ791813', 'ERZ791814', 'ERZ791815', 'ERZ791816', 'ERZ791817', 'ERZ791818', 'ERZ791819', 'ERZ791820', 'ERZ791821', 'ERZ791822', 'ERZ791823', 'ERZ791824', 'ERZ791825', 'ERZ791826', 'ERZ791827', 'ERZ791828', 'ERZ791829', 'ERZ791830', 'ERZ791831', 'ERZ791832', 'ERZ791833', 'ERZ791834', 'ERZ791835', 'ERZ791836', 'ERZ791837', 'ERZ791838', 'ERZ791839', 'ERZ791840', 'ERZ791841', 'ERZ791842', 'ERZ791843', 'ERZ791844', 'ERZ791845', 'ERZ791846', 'ERZ791847', 'ERZ791848', 'ERZ791849', 'ERZ791850', 'ERZ791851', 'ERZ791852', 'ERZ791853', 'ERZ791854', 'ERZ791855', 'ERZ791856', 'ERZ791857', 'ERZ791858', 'ERZ791859', 'ERZ791860', 'ERZ791861', 'ERZ791862', 'ERZ791863', 'ERZ791864', 'ERZ791865', 'ERZ791866', 'ERZ791867', 'ERZ791868', 'ERZ791869', 'ERZ791870', 'ERZ791871', 'ERZ791872', 'ERZ791873', 'ERZ791874', 'ERZ791875', 'ERZ791876', 'ERZ791877', 'ERZ791878', 'ERZ791879', 'ERZ791880', 'ERZ791881', 'ERZ791882', 'ERZ791883', 'ERZ791884', 'ERZ791885', 'ERZ791886', 'ERZ791887', 'ERZ791888', 'ERZ791889', 'ERZ791890', 'ERZ791891', 'ERZ791892', 'ERZ791893', 'ERZ791894', 'ERZ791895', 'ERZ791896', 'ERZ791897', 'ERZ791898', 'ERZ791899', 'ERZ791900', 'ERZ791901', 'ERZ791902', 'ERZ791903', 'ERZ791904', 'ERZ791905', 'ERZ791906', 'ERZ791907', 'ERZ791908', 'ERZ791909', 'ERZ791910', 'ERZ791911', 'ERZ791912', 'ERZ791913', 'ERZ791914', 'ERZ791915', 'ERZ791916', 'ERZ791917', 'ERZ791918', 'ERZ791919', 'ERZ791920', 'ERZ791921', 'ERZ791922', 'ERZ791923', 'ERZ791924', 'ERZ791925', 'ERZ791926', 'ERZ791927', 'ERZ791928', 'ERZ791929', 'ERZ791930', 'ERZ791931', 'ERZ791932', 'ERZ791933', 'ERZ791934', 'ERZ791935', 'ERZ791936', 'ERZ791937', 'ERZ791938']
print(len(acclist))
print(len(acclist2))

# Ignore certificates so python can load https links
ctx = ssl.create_default_context()
ctx.check_hostname = False
ctx.verify_mode = ssl.CERT_NONE
accdict = {}
countdict = {}
#open sample xml, retrieve the two accessions for the sample
#create a dictionary containing the SRR accession as the key and the ERZ as the value
for acc in acclist2:
    url = 'https://www.ebi.ac.uk/ena/data/view/' + acc + '&display=xml'
    html = urllib.request.urlopen(url, context=ctx).read()
    tree = ET.fromstring(html)
    ERZid = tree.find('ANALYSIS/IDENTIFIERS/PRIMARY_ID').text
    SRRid = tree.find('ANALYSIS').get('alias')
    accdict[SRRid] = ERZid
    #countdict[SRRid] = 1
    #print(ERZid, SRRid)
#print(accdict)
#print(countdict)
print(len(accdict))
#print(len(countdict))

# use target accession list to search through dictionary and build list of urls that can be fed into a shell script 
dllinks = ""
for i in acclist:
    if i in accdict:
        #print(i)
        #print(accdict[i])
        ERZ = accdict[i]
        dllinks = dllinks + 'ftp://ftp.sra.ebi.ac.uk/vol1/' + ERZ[0:6] + '/' + ERZ + '/' + i + '.fasta.gz '
    else:
        print('***not found***')
print(dllinks)
fout = open('dllinks.txt', 'w')
fout.write(dllinks)
fout.close()
